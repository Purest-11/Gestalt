<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gestalt ¬∑ Touch</title>
    
    <!-- i18n Translation Script -->
    <script src="/lang/translations.js"></script>
    
    <!-- ÂºïÂÖ• Google Fonts ÁßëÊäÄÊÑüÂ≠ó‰Ωì -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/style.css">

    <!-- Ë∞ÉËØïÊéßÂà∂Âè∞Ê†∑Âºè -->
    <style>
        #debug-console {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            font-family: monospace;
            font-size: 10px;
            overflow-y: auto;
            z-index: 9999;
            pointer-events: none; /* ËÆ©ÁÇπÂáªÁ©øÈÄè */
            padding: 5px;
            border-top: 1px solid #333;
            display: none; /* ÈªòËÆ§ÈöêËóèÔºåÁÇπÂáª 3 Ê¨°ÊòæÁ§∫ */
        }
        .log-error { color: #ff3333; }
        .log-warn { color: #ffff33; }
        .log-info { color: #cccccc; }
        
        /* Language Switcher - Cyberpunk Style */
        .lang-switcher-corner {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .lang-btn {
            padding: 8px 14px;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(189, 0, 255, 0.1) 100%);
            border: 1px solid rgba(0, 255, 255, 0.4);
            border-radius: 4px;
            color: #00ffff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2), inset 0 0 10px rgba(0, 255, 255, 0.05);
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
        }
        
        .lang-btn:hover {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2) 0%, rgba(189, 0, 255, 0.2) 100%);
            border-color: rgba(0, 255, 255, 0.7);
            color: #fff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4), inset 0 0 15px rgba(0, 255, 255, 0.1);
            text-shadow: 0 0 12px rgba(0, 255, 255, 0.8);
        }
        
        .lang-btn:active {
            transform: scale(0.95);
            box-shadow: 0 0 25px rgba(189, 0, 255, 0.5), inset 0 0 20px rgba(189, 0, 255, 0.15);
            border-color: rgba(189, 0, 255, 0.7);
        }
    </style>

    <!-- ÂºïÂÖ• Three.js -->
    <!-- ‰ΩøÁî®Êú¨Âú∞Ë∑ØÂæÑÔºåÁ°Æ‰øùÊó†ÈúÄÂ§ñÁΩëÂç≥ÂèØËÆøÈóÆ -->
    <script type="importmap">
    {
        "imports": {
            "three": "/lib/three/build/three.module.js",
            "three/addons/": "/lib/three/examples/jsm/"
        }
    }
    </script>
</head>
<body>
    <!-- Language Switcher -->
    <div class="lang-switcher-corner">
        <button class="lang-btn" id="langBtn" onclick="toggleLanguageAndReload()">üåç ‰∏≠Êñá</button>
    </div>

    <!-- Ë∞ÉËØïÊéßÂà∂Âè∞ -->
    <div id="debug-console"></div>

    <!-- Âä†ËΩΩÂ±è / Loading Screen -->
    <div id="loader">
        <div class="loader-spinner"></div>
        <div class="loader-text" id="loaderText">INITIALIZING SYSTEM</div>
        <div id="loading-status" style="margin-top:10px; font-size: 10px; color: #666;"></div>
    </div>

    <!-- 3D ÁîªÂ∏ÉÂÆπÂô® -->
    <div id="canvas-container"></div>

    <!-- Ëß¶Êë∏Â±Ç - ‰∏ìÈó®Áî®‰∫éÊé•Êî∂Ëß¶Êë∏‰∫ã‰ª∂ÔºåÁ°Æ‰øùÂú®ÊúÄ‰∏äÂ±Ç -->
    <div id="touch-layer" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; touch-action: none;"></div>

    <!-- UI Ë¶ÜÁõñÂ±Ç (pointer-events: none) -->
    <div id="ui-layer">
        <!-- È°∂ÈÉ® -->
        <div class="header" id="header-area">
            <div class="brand-badge">‚óà Gestalt</div>
            <div class="status-badge">
                <div class="status-dot" id="status-dot"></div>
                <span id="status-text">CONNECTING</span>
            </div>
            <div class="status-badge">
                <span>üë•</span>
                <span id="audience-count">0</span>
            </div>
        </div>

        <!-- ‰∏≠ÂøÉÊèêÁ§∫ -->
        <div class="center-guide" id="guide">
            <div class="guide-icon">üëÜ</div>
            <div class="guide-text">TOUCH TO INTERACT</div>
        </div>

        <!-- Âè≥‰æßÂº∫Â∫¶Êù° -->
        <div class="intensity-meter">
            <div class="intensity-fill" id="intensity-fill"></div>
        </div>

        <!-- Â∫ïÈÉ®‰ø°ÊÅØ -->
        <div class="dashboard">
            <div class="gesture-display">
                <div class="gesture-label">CURRENT GESTURE</div>
                <div class="gesture-value" id="gesture-name">IDLE</div>
            </div>
        </div>
    </div>

    <!-- Ë∞ÉËØïËÑöÊú¨ÔºöÈáçÂÜô console ‰ª•ÊòæÁ§∫Âú®Â±èÂπï‰∏ä -->
    <script>
        const consoleDiv = document.getElementById('debug-console');
        const loadingStatus = document.getElementById('loading-status');
        
        function appendLog(msg, type) {
            const line = document.createElement('div');
            line.className = 'log-' + type;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            
            // ÂêåÊó∂‰πüÊòæÁ§∫Âú®Âä†ËΩΩÂ±è‰∏äÔºåÊñπ‰æøÊü•ÁúãÂàùÂßãÂåñÈîôËØØ
            if (type === 'error') {
                loadingStatus.textContent = msg;
                loadingStatus.style.color = '#ff3333';
            }
        }

        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            originalLog.apply(console, args);
            appendLog(args.join(' '), 'info');
        };
        console.error = function(...args) {
            originalError.apply(console, args);
            appendLog(args.join(' '), 'error');
            // Â¶ÇÊûúÂá∫Áé∞ÈîôËØØÔºåËá™Âä®ÊòæÁ§∫ÊéßÂà∂Âè∞
            consoleDiv.style.display = 'block';
        };
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            appendLog(args.join(' '), 'warn');
        };

        // ÁÇπÂáªÈ°∂ÈÉ®Âå∫Âüü 3 Ê¨°ÂàáÊç¢Ë∞ÉËØïÂè∞
        let tapCount = 0;
        document.getElementById('header-area').addEventListener('click', () => {
            tapCount++;
            if (tapCount === 3) {
                consoleDiv.style.display = consoleDiv.style.display === 'none' ? 'block' : 'none';
                tapCount = 0;
            }
        });

        window.onerror = function(msg, source, lineno, colno, error) {
            console.error(`${msg} (${source}:${lineno})`);
        };
    </script>

    <!-- i18n Initialization -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (window.i18n) {
                const lang = window.i18n.getCurrentLanguage();
                const langBtn = document.getElementById('langBtn');
                if (langBtn) {
                    langBtn.textContent = lang === 'en' ? 'üåç ‰∏≠Êñá' : 'üåç EN';
                }
                
                // Update texts based on language
                const loaderText = document.getElementById('loaderText');
                if (loaderText) {
                    loaderText.textContent = lang === 'zh' ? 'Á≥ªÁªüÂàùÂßãÂåñ‰∏≠' : 'INITIALIZING SYSTEM';
                }
                
                const guideText = document.querySelector('.guide-text');
                if (guideText) {
                    guideText.textContent = lang === 'zh' ? 'Ëß¶Êë∏Â±èÂπï‰∫§‰∫í' : 'TOUCH TO INTERACT';
                }
                
                const gestureLabel = document.querySelector('.gesture-label');
                if (gestureLabel) {
                    gestureLabel.textContent = lang === 'zh' ? 'ÂΩìÂâçÊâãÂäø' : 'CURRENT GESTURE';
                }
                
                document.title = window.i18n.t('touch.title');
            }
        });
    </script>

    <!-- Â∫îÁî®ÂÖ•Âè£ / App Entry -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
