# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# â—ˆ Gestalt - Docker Compose Configuration
# 
# Usage:
#   Start:  docker-compose up -d
#   Stop:   docker-compose down
#   Logs:   docker-compose logs -f
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

version: '3.8'

services:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ­ Performer System (Port 3000, OSC 7400)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  performer:
    build: .
    container_name: gestalt-performer
    restart: unless-stopped
    ports:
      # Web æœåŠ¡
      - "3000:3000"
      # OSC UDP ç«¯å£ï¼ˆç”¨äºæ¥æ”¶ï¼‰
      - "7400:7400/udp"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - OSC_PORT=7400
      - PERFORMER_ID=1
      # Docker ä¸­ç¦ç”¨å¹¿æ’­ï¼Œæ”¹ä¸ºç›´æ¥å‘é€åˆ°å®¿ä¸»æœº
      - USE_BROADCAST=false
      # host.docker.internal æ˜¯ Docker Desktop ä¸­æŒ‡å‘å®¿ä¸»æœºçš„ç‰¹æ®Šåœ°å€
      - OSC_HOST=host.docker.internal
    extra_hosts:
      # ç¡®ä¿ host.docker.internal åœ¨ Linux ä¸Šä¹Ÿèƒ½å·¥ä½œ
      - "host.docker.internal:host-gateway"
    volumes:
      # æŒ‚è½½æ—¥å¿—ç›®å½•ï¼ˆå¯é€‰ï¼‰
      - ./logs/performer:/app/logs
    networks:
      - gestalt-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ‘¥ Audience System (Port 3002, OSC 7402)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  audience:
    build: .
    container_name: gestalt-audience
    restart: unless-stopped
    ports:
      # Web æœåŠ¡
      - "3002:3002"
      # OSC UDP ç«¯å£ï¼ˆç”¨äºæ¥æ”¶ï¼‰
      - "7402:7402/udp"
    environment:
      - NODE_ENV=production
      - PORT=3002
      - OSC_PORT=7402
      - PERFORMER_ID=audience
      # Docker ä¸­ç¦ç”¨å¹¿æ’­ï¼Œæ”¹ä¸ºç›´æ¥å‘é€åˆ°å®¿ä¸»æœº
      - USE_BROADCAST=false
      # host.docker.internal æ˜¯ Docker Desktop ä¸­æŒ‡å‘å®¿ä¸»æœºçš„ç‰¹æ®Šåœ°å€
      - OSC_HOST=host.docker.internal
    extra_hosts:
      # ç¡®ä¿ host.docker.internal åœ¨ Linux ä¸Šä¹Ÿèƒ½å·¥ä½œ
      - "host.docker.internal:host-gateway"
    volumes:
      # æŒ‚è½½æ—¥å¿—ç›®å½•ï¼ˆå¯é€‰ï¼‰
      - ./logs/audience:/app/logs
    networks:
      - gestalt-network
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3002/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    depends_on:
      - performer

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Network Configuration
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
networks:
  gestalt-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/16

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Usage Guide
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 
# ğŸš€ Start:
#   docker-compose up -d
#
# ğŸ›‘ Stop:
#   docker-compose down
#
# ğŸ“Š Logs:
#   docker-compose logs -f              # All services
#   docker-compose logs -f performer    # Performer only
#   docker-compose logs -f audience     # Audience only
#
# ğŸ”„ Restart:
#   docker-compose restart
#
# ğŸ“ Access URLs:
#   Performer:     http://localhost:3000/?performer=1
#   Motion Capture: http://localhost:3000/mocap/?performer=1
#   Audience Touch: http://localhost:3002/audience-touch/
#   Stage Monitor:  http://localhost:3002/?performer=audience
#
# ğŸ® Max/MSP Configuration (run on host machine):
#   Performer: [udpreceive 7400]
#   Audience:  [udpreceive 7402]
#
# ğŸ’¡ Note:
#   OSC messages are sent to host via host.docker.internal
#   Ensure Max/MSP is running on host and listening on ports
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
