# ğŸ³ Gestalt Docker éƒ¨ç½²æŒ‡å—

> ä½¿ç”¨ Docker ä¸€é”®éƒ¨ç½² Gestalt äº’åŠ¨æ¼”å‡ºç³»ç»Ÿ

---

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [äº¤äº’å¼å¯åŠ¨å™¨](#äº¤äº’å¼å¯åŠ¨å™¨æ¨è)
- [éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©](#éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©)
- [å‰ç½®è¦æ±‚](#å‰ç½®è¦æ±‚)
- [æ‰‹åŠ¨å‘½ä»¤å‚è€ƒ](#æ‰‹åŠ¨å‘½ä»¤å‚è€ƒ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## âš ï¸ é‡è¦ï¼šå»¶è¿Ÿä¸æ–¹æ¡ˆé€‰æ‹©

| éƒ¨ç½²æ–¹æ¡ˆ | å»¶è¿Ÿ | é€‚åˆåœºæ™¯ |
|----------|------|----------|
| **æœ¬åœ° WiFiï¼ˆæ¨èï¼‰** | 20-30ms â­ | æ­£å¼æ¼”å‡ºã€å®æ—¶äº¤äº’ |
| **Docker + æœ¬åœ°ç½‘ç»œ** | 20-30ms â­ | æ­£å¼æ¼”å‡ºã€å®æ—¶äº¤äº’ |
| **Cloudflareï¼ˆå¾·å›½/æ¬§æ´²ï¼‰** | 50-150ms âœ“ | å›½é™…ä¼šè®®ï¼ˆå¦‚ ICMCï¼‰ |
| **Cloudflareï¼ˆä¸­å›½è®¿é—®ï¼‰** | 700-1200ms âŒ | ä¸æ¨èå®æ—¶æ¼”å‡º |
| **cpolarï¼ˆä¸­å›½ï¼‰** | 50-200ms âœ“ | å›½å†…æ¼”å‡º |

**ğŸ¯ æœ€ä½³å®è·µ**ï¼šæ­£å¼æ¼”å‡ºè¯·ä½¿ç”¨**ä¾¿æºè·¯ç”±å™¨ + æœ¬åœ° WiFi** æ–¹æ¡ˆã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£… Docker Desktop

ä¸‹è½½åœ°å€ï¼šhttps://www.docker.com/products/docker-desktop/

å®‰è£…åå¯åŠ¨ï¼Œç­‰å¾…æ˜¾ç¤º "Docker is running"ã€‚

### 2. å¯åŠ¨ç³»ç»Ÿ

```bash
cd gestalt
./docker-start.sh
```

é¦–æ¬¡å¯åŠ¨éœ€è¦ 2-5 åˆ†é’Ÿä¸‹è½½é•œåƒã€‚

---

## ğŸ›ï¸ äº¤äº’å¼å¯åŠ¨å™¨ï¼ˆæ¨èï¼‰

è¿è¡Œ `./docker-start.sh` ä¼šæ˜¾ç¤ºäº¤äº’å¼èœå•ï¼š

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸš€ å•æœºæ¨¡å¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  1) ğŸ­ æœ¬åœ°æ¼”å‡ºæ¨¡å¼        â† é¦–æ¬¡æµ‹è¯•é€‰è¿™ä¸ª
  2) ğŸŒ å…¬ç½‘æ¨¡å¼ [Cloudflare]
  3) ğŸ‡¨ğŸ‡³ å…¬ç½‘æ¨¡å¼ [cpolar]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ–¥ï¸ğŸ–¥ï¸ åŒæœºæ¨¡å¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  4) ğŸ‘ï¸ è§†è§‰æœº - æœ¬åœ°è§‚ä¼—
  5) ğŸŒ è§†è§‰æœº - å…¬ç½‘ [Cloudflare]
  6) ğŸ‡¨ğŸ‡³ è§†è§‰æœº - å…¬ç½‘ [cpolar]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  âš™ï¸ ç®¡ç†
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  7) ğŸ“Š æŸ¥çœ‹çŠ¶æ€
  8) ğŸ“‹ æŸ¥çœ‹æ—¥å¿—
  9) ğŸ”„ é‡æ–°æ„å»º
  0) ğŸ”‘ é…ç½® cpolar
  m) ğŸš€ é…ç½®é•œåƒåŠ é€Ÿ [ä¸­å›½ç”¨æˆ·å¿…çœ‹]
  L) ğŸŒ åˆ‡æ¢è¯­è¨€
  s) ğŸ›‘ åœæ­¢æ‰€æœ‰æœåŠ¡
  q) é€€å‡º
```

**é¦–æ¬¡æµ‹è¯•é€‰æ‹© `1`ï¼ˆæœ¬åœ°æ¼”å‡ºæ¨¡å¼ï¼‰ã€‚**

å¯åŠ¨åä¼šæ˜¾ç¤ºè®¿é—®åœ°å€ï¼š

| é¡µé¢ | åœ°å€ |
|------|------|
| åŠ¨ä½œæ•æ‰ | http://localhost:3000/mocap/?performer=1 |
| è§‚ä¼—è§¦æ‘¸ | http://ä½ çš„IP:3002/audience-touch/ |
| ç›‘æ§é¢æ¿ | http://localhost:3002/?performer=audience |

### Max/MSP é…ç½®

```
[udpreceive 7400]    â† æ¼”å‘˜æ•°æ®
[udpreceive 7402]    â† è§‚ä¼—æ•°æ®
      |
[oscparse]
```

---

## ğŸ¯ éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆ Aï¼šæœ¬åœ°æ¼”å‡ºï¼ˆæ¨èï¼‰

```
ä¾¿æºè·¯ç”±å™¨/WiFi çƒ­ç‚¹
    â”œâ”€â”€ æ‚¨çš„ç”µè„‘ï¼ˆè¿è¡Œ Dockerï¼‰
    â”œâ”€â”€ è§‚ä¼—æ‰‹æœº 1
    â”œâ”€â”€ è§‚ä¼—æ‰‹æœº 2
    â””â”€â”€ ...
```

**ä¼˜ç‚¹**ï¼šå»¶è¿Ÿæœ€ä½ï¼ˆ20-30msï¼‰ï¼Œç¨³å®šå¯é 
**é€‚åˆ**ï¼šæ­£å¼æ¼”å‡ºã€å®æ—¶éŸ³ä¹è¡¨æ¼”

### æ–¹æ¡ˆ Bï¼šDocker + Cloudflareï¼ˆå›½é™…æ¼”å‡ºï¼‰

```
æ‚¨çš„ç”µè„‘ï¼ˆå¾·å›½ï¼‰
    â””â”€â”€ Docker + Cloudflare Tunnel
            â””â”€â”€ å…¬ç½‘ URL â†’ è§‚ä¼—è®¿é—®
```

**ä¼˜ç‚¹**ï¼šè§‚ä¼—æ— éœ€è¿æ¥åŒä¸€ WiFi
**é€‚åˆ**ï¼šICMC ç­‰å›½é™…ä¼šè®®ï¼ˆåœ¨æ¬§æ´²ä½¿ç”¨å»¶è¿Ÿçº¦ 50-150msï¼‰

### æ–¹æ¡ˆ Cï¼šäº‘æœåŠ¡å™¨éƒ¨ç½²

```
äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘/AWSï¼‰
    â””â”€â”€ Docker å®¹å™¨
            â””â”€â”€ å›ºå®š IP/åŸŸå â†’ è§‚ä¼—è®¿é—®
```

**ä¼˜ç‚¹**ï¼šç¨³å®šã€å¯æå‰éƒ¨ç½²
**é€‚åˆ**ï¼šé•¿æœŸå±•è§ˆã€ä½œå“å±•ç¤º

---

## ğŸ“¦ å‰ç½®è¦æ±‚

### å®‰è£… Docker

**macOSï¼š**
```bash
# æ–¹å¼1ï¼šä¸‹è½½ Docker Desktop
# https://www.docker.com/products/docker-desktop

# æ–¹å¼2ï¼šä½¿ç”¨ Homebrew
brew install --cask docker
```

**Windowsï¼š**
- ä¸‹è½½ [Docker Desktop for Windows](https://www.docker.com/products/docker-desktop)

**Linuxï¼š**
```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker $USER

# é‡æ–°ç™»å½•åç”Ÿæ•ˆ
```

### éªŒè¯å®‰è£…

```bash
docker --version
docker-compose --version
```

---

## ğŸ­ æœ¬åœ°æ¼”å‡ºæ¨¡å¼

é€‚åˆæ­£å¼æ¼”å‡ºï¼ˆè§‚ä¼—ä¸æ¼”å‘˜åœ¨åŒä¸€WiFiï¼‰

### å¯åŠ¨

```bash
docker-compose up -d
```

### è®¿é—®åœ°å€

| ç³»ç»Ÿ | åœ°å€ |
|------|------|
| æ¼”å‘˜ OSC æ§åˆ¶å™¨ | http://localhost:3000/?performer=1 |
| æ¼”å‘˜ MediaPipe | http://localhost:3000/mocap/?performer=1 |
| è§‚ä¼—è§¦æ‘¸å…¥å£ | http://ä½ çš„IP:3002/audience-touch/ |
| è§‚ä¼—ç›‘æ§é¢æ¿ | http://localhost:3002/?performer=audience |

### Max MSP é…ç½®

```maxpat
[udpreceive 7400]  â†’ æ¼”å‘˜æ•°æ®
[udpreceive 7402]  â†’ è§‚ä¼—æ•°æ®
```

### åœæ­¢

```bash
docker-compose down
```

---

## ğŸŒ å…¬ç½‘æ¼”å‡ºæ¨¡å¼

é€‚åˆå›½é™…æ¼”å‡ºï¼ˆè§‚ä¼—å¯ç”¨ 4G/5Gï¼Œæ— éœ€åŒä¸€ç½‘ç»œï¼‰

> âš ï¸ **æ³¨æ„**ï¼šæ­¤æ¨¡å¼å»¶è¿Ÿè¾ƒé«˜ï¼Œåœ¨ä¸­å›½ä½¿ç”¨çº¦ 700-1200msï¼Œåœ¨æ¬§æ´²ä½¿ç”¨çº¦ 50-150ms

### å¯åŠ¨

```bash
docker-compose -f docker-compose.yml -f docker-compose.tunnel.yml up -d
```

### è·å–å…¬ç½‘ URL

```bash
# æŸ¥çœ‹éš§é“æ—¥å¿—
docker-compose logs tunnel | grep "trycloudflare.com"
```

ä¼šæ˜¾ç¤ºç±»ä¼¼ï¼š
```
https://random-string.trycloudflare.com
```

è§‚ä¼—è®¿é—®ï¼š`https://random-string.trycloudflare.com/audience-touch/`

### åœæ­¢

```bash
docker-compose -f docker-compose.yml -f docker-compose.tunnel.yml down
```

---

## â˜ï¸ äº‘æœåŠ¡å™¨éƒ¨ç½²

é€‚åˆæ­£å¼æ¼”å‡ºæˆ–é•¿æœŸå±•è§ˆ

### æ¨èé…ç½®

| é…ç½®é¡¹ | æ¨èå€¼ |
|--------|--------|
| CPU | 2æ ¸+ |
| å†…å­˜ | 4GB+ |
| å¸¦å®½ | 5Mbps+ |
| ç³»ç»Ÿ | Ubuntu 22.04 |

### éƒ¨ç½²æ­¥éª¤

```bash
# 1. SSH è¿æ¥æœåŠ¡å™¨
ssh user@your-server-ip

# 2. å®‰è£… Docker
curl -fsSL https://get.docker.com | sh

# 3. å…‹éš†ä»£ç 
git clone https://github.com/your-repo/osc.git
cd osc

# 4. å¯åŠ¨
docker-compose up -d

# 5. å¼€æ”¾é˜²ç«å¢™
sudo ufw allow 3000
sudo ufw allow 3002
sudo ufw allow 7400/udp
sudo ufw allow 7402/udp
```

### ä½¿ç”¨åŸŸåï¼ˆå¯é€‰ï¼‰

é…åˆ Nginx åå‘ä»£ç†ï¼š

```nginx
# /etc/nginx/sites-available/osc
server {
    listen 80;
    server_name audience.yourdomain.com;

    location / {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }
}
```

---

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

### åŸºæœ¬æ“ä½œ

```bash
# å¯åŠ¨ï¼ˆåå°è¿è¡Œï¼‰
docker-compose up -d

# åœæ­¢
docker-compose down

# é‡å¯
docker-compose restart

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs -f

# ä»…æ¼”å‘˜ç³»ç»Ÿ
docker-compose logs -f performer

# ä»…è§‚ä¼—ç³»ç»Ÿ
docker-compose logs -f audience

# ä»…éš§é“ï¼ˆå…¬ç½‘æ¨¡å¼ï¼‰
docker-compose logs -f tunnel
```

### é•œåƒç®¡ç†

```bash
# é‡æ–°æ„å»ºé•œåƒï¼ˆä»£ç æ›´æ–°åï¼‰
docker-compose build

# å¼ºåˆ¶é‡å»º
docker-compose build --no-cache

# æ›´æ–°å¹¶é‡å¯
docker-compose up -d --build
```

### æ¸…ç†

```bash
# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose down

# åˆ é™¤æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬æ—¥å¿—ï¼‰
docker-compose down -v

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker system prune -a
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

å¯åœ¨ `docker-compose.yml` ä¸­ä¿®æ”¹ï¼š

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| PORT | 3000/3002 | Web æœåŠ¡ç«¯å£ |
| OSC_PORT | 7400/7402 | OSC UDP ç«¯å£ |
| PERFORMER_ID | 1/audience | ç³»ç»Ÿæ ‡è¯† |
| USE_BROADCAST | true | å¯ç”¨ UDP å¹¿æ’­ |

### è‡ªå®šä¹‰ç«¯å£

```yaml
# docker-compose.yml
services:
  performer:
    ports:
      - "8000:3000"  # æ”¹ä¸º 8000 ç«¯å£
      - "8400:7400/udp"
```

---

## â“ æ•…éšœæ’é™¤

### ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :3000

# åœæ­¢å ç”¨è¿›ç¨‹
kill -9 <PID>

# æˆ–ä¿®æ”¹ docker-compose.yml ä½¿ç”¨å…¶ä»–ç«¯å£
```

### å®¹å™¨å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs performer

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker-compose exec performer sh
```

### Max MSP æ”¶ä¸åˆ° OSC

1. ç¡®è®¤ OSC ç«¯å£æ­£ç¡®ï¼ˆ7400/7402ï¼‰
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. ç¡®è®¤ Max MSP çš„ `udpreceive` å¯¹è±¡ç«¯å£è®¾ç½®æ­£ç¡®

```bash
# æµ‹è¯• OSC ç«¯å£
docker-compose exec performer nc -uzv localhost 7400
```

### è§‚ä¼—æ— æ³•è®¿é—®

1. æ£€æŸ¥æœ¬æœº IPï¼š`ifconfig` æˆ– `ipconfig`
2. ç¡®è®¤æ‰‹æœºä¸ç”µè„‘åœ¨åŒä¸€ WiFi
3. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦é˜»æ­¢ 3002 ç«¯å£

---

## ğŸ“Š æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Docker Host                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   performer   â”‚         â”‚   audience    â”‚               â”‚
â”‚  â”‚  (æ¼”å‘˜ç³»ç»Ÿ)   â”‚         â”‚  (è§‚ä¼—ç³»ç»Ÿ)   â”‚               â”‚
â”‚  â”‚  Port: 3000   â”‚         â”‚  Port: 3002   â”‚               â”‚
â”‚  â”‚  OSC: 7400    â”‚         â”‚  OSC: 7402    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚          â”‚                         â”‚                        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                    â”‚                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚            â”‚    tunnel     â”‚  (å¯é€‰ï¼šå…¬ç½‘æ¨¡å¼)              â”‚
â”‚            â”‚  Cloudflare   â”‚                                â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚
         â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ¼”å‘˜ç«¯  â”‚   â”‚ è§‚ä¼—æ‰‹æœº â”‚   â”‚   Max MSP   â”‚
    â”‚ æµè§ˆå™¨  â”‚   â”‚  æµè§ˆå™¨  â”‚   â”‚  udpreceive â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ç‰ˆæœ¬æ›´æ–°

å½“ä»£ç æ›´æ–°åï¼Œé‡æ–°éƒ¨ç½²ï¼š

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æ–¹æ¡ˆæ€»è§ˆ](DEPLOYMENT_SOLUTIONS.md)
- [ä¸» README](README.md)

---

## ğŸ“± é Docker éƒ¨ç½²ï¼ˆæœ¬åœ°ç›´æ¥è¿è¡Œï¼‰

å¦‚æœä¸ä½¿ç”¨ Dockerï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼š

```bash
# ä½¿ç”¨ç»Ÿä¸€å¯åŠ¨è„šæœ¬
./start.sh

# é€‰æ‹©å¯¹åº”æ¨¡å¼ï¼š
# 1 - æœ¬åœ°æ¼”å‡ºæ¨¡å¼ + åˆ†å±
# 2 - å…¬ç½‘æ¨¡å¼ï¼ˆå›½å¤– Cloudflareï¼‰+ åˆ†å±
# 3 - å…¬ç½‘æ¨¡å¼ï¼ˆå›½å†… cpolarï¼‰+ åˆ†å±
```

å¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- åœ¨ Safari æ‰“å¼€ MediaPipe åŠ¨ä½œæ•æ‰ï¼ˆå·¦ä¾§ï¼‰
- åœ¨ Chrome æ‰“å¼€è§‚ä¼—ç³»ç»Ÿç›‘æ§ï¼ˆå³ä¾§ï¼‰

---

**äº«å—ä½ çš„äº’åŠ¨æ¼”å‡ºï¼** ğŸ­ğŸµâœ¨
